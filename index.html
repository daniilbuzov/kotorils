<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes">
    <title>–ö–û–¢–û-–†–ò–õ–° ¬∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –Ω–æ—É—Ç–±—É–∫–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        body {
            background: #1a1727;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 12px;
        }
        .cat-reels-app {
            width: 100%;
            max-width: 460px;
            height: min(820px, 95vh);
            background: #0b0914;
            border-radius: 48px 48px 28px 28px;
            overflow: hidden;
            box-shadow: 0 30px 60px #000000cc, 0 0 0 2px #4e3991 inset;
            display: flex;
            flex-direction: column;
            transition: max-width 0.2s;
        }
        /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –Ω–æ—É—Ç–±—É–∫–æ–≤ –∏ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (min-width: 1000px) {
            .cat-reels-app {
                max-width: 700px;
                height: 900px;
            }
            .logo { font-size: 1.8rem; }
            .counter { font-size: 1rem; padding: 8px 24px; }
            .name { font-size: 1.6rem; }
            .origin { font-size: 1rem; }
            .like-btn { font-size: 1.3rem; padding: 14px 32px; }
            .action-btn { font-size: 1.2rem; padding: 14px 28px; }
            .url-input { font-size: 1.1rem; padding: 16px 22px; }
            .icon-btn { width: 64px; height: 64px; font-size: 32px; }
            .avatar { width: 64px; height: 64px; font-size: 40px; }
        }

        .header {
            padding: 18px 20px 8px;
            display: flex;
            justify-content: space-between;
            background: #0f0d1c;
            border-bottom: 1px solid #342d4a;
        }
        .logo {
            font-weight: 800;
            font-size: 1.5rem;
            background: linear-gradient(145deg, #ffd6a8, #d6b1ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .counter {
            background: #282041;
            padding: 6px 20px;
            border-radius: 40px;
            font-weight: 600;
            color: #eee3ff;
            border: 1px solid #9577d9;
        }

        .content-scroll {
            flex: 1;
            overflow-y: auto;
            scrollbar-width: none;
            background: #0a0815;
        }
        .content-scroll::-webkit-scrollbar { display: none; }

        .feed {
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
        }
        .reel {
            height: 100%;
            scroll-snap-align: start;
            position: relative;
            background: #0e0c1a;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }
        .media-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .media-container img, .media-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .media-fallback {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #1a1440;
            color: #dbbaff;
            font-size: 2rem;
            text-align: center;
            padding: 20px;
        }
        .media-fallback span {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        .gradient {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40%;
            background: linear-gradient(transparent, #000000e0);
            pointer-events: none;
            z-index: 2;
        }
        .reel-footer {
            position: relative;
            z-index: 3;
            padding: 20px 20px 40px;
            color: white;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }
        .cat-details {
            display: flex;
            align-items: center;
            gap: 12px;
            pointer-events: auto;
        }
        .avatar {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: linear-gradient(145deg, #af88eb, #e1aac9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            border: 2px solid #ffffffd0;
        }
        .name {
            font-weight: 800;
            font-size: 1.4rem;
            text-shadow: 0 2px 8px black;
        }
        .origin {
            color: #cfb9ff;
            font-size: 0.9rem;
        }
        .actions {
            display: flex;
            gap: 18px;
            pointer-events: auto;
        }
        .like-btn {
            background: rgba(20, 15, 35, 0.7);
            backdrop-filter: blur(8px);
            border: 1.5px solid #a17cff;
            border-radius: 60px;
            padding: 12px 28px;
            font-weight: 700;
            font-size: 1.2rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 6px 14px black;
            cursor: pointer;
            transition: 0.1s;
        }
        .like-btn.liked {
            background: #301f30;
            border-color: #ff94c8;
            color: #ffcef0;
        }
        .like-btn:active { transform: scale(0.94); }
        .action-btn {
            background: rgba(20, 15, 35, 0.7);
            backdrop-filter: blur(8px);
            border: 1.5px solid #5f4d8a;
            border-radius: 60px;
            padding: 12px 24px;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .loading-indicator {
            text-align: center;
            padding: 30px;
            color: #b19bff;
            font-weight: 600;
            font-size: 1.2rem;
            scroll-snap-align: start;
            background: #0b0818;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
        }
        .spinner {
            width: 28px;
            height: 28px;
            border: 4px solid #a081d9;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .upload-bar {
            background: #141025;
            border-top: 2px solid #5b4591;
            padding: 16px 16px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .url-input {
            flex: 3 1 200px;
            background: #262035;
            border: 1px solid #7c5fd1;
            border-radius: 60px;
            padding: 14px 20px;
            color: white;
            font-size: 1rem;
            outline: none;
        }
        .url-input::placeholder { color: #ab96da; }
        .icon-btn {
            background: #6c4bc2;
            border: none;
            width: 56px;
            height: 56px;
            border-radius: 56px;
            font-size: 28px;
            color: white;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 0 #3d2d66;
            cursor: pointer;
            transition: 0.07s linear;
            flex: 0 0 auto;
        }
        .icon-btn:active {
            transform: translateY(5px);
            box-shadow: 0 1px 0 #3d2d66;
        }
        #fileInput { display: none; }

        .bottom-nav {
            display: flex;
            justify-content: center;
            gap: 30px;
            background: #110f1d;
            border-top: 1px solid #40375f;
            padding: 10px 20px 16px;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #988fc0;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            padding: 6px 22px;
            border-radius: 40px;
            transition: 0.1s;
        }
        .nav-item.active {
            background: #2b2348;
            color: #f0d2ff;
        }
        .nav-icon { font-size: 28px; }

        .profile-header {
            padding: 24px 20px;
            background: #121020;
            color: white;
        }
        .profile-stats {
            display: flex;
            gap: 30px;
            align-items: center;
            margin: 16px 0;
        }
        .big-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #8e6dd6;
            font-size: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .stat {
            text-align: center;
        }
        .stat-num {
            font-size: 26px;
            font-weight: 800;
        }
        .stat-label { color: #bbaaec; }
        .tabs {
            display: flex;
            border-bottom: 2px solid #322c4a;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 16px;
            font-weight: 700;
            color: #a18fd2;
            cursor: pointer;
        }
        .tab.active {
            color: #fad7ff;
            border-bottom: 4px solid #d0a0ff;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            background: #141026;
            padding: 2px;
        }
        .grid-item {
            aspect-ratio: 1/1;
            background: #231e37;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }
        .grid-item img, .grid-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .video-badge {
            position: absolute;
            bottom: 4px;
            right: 4px;
            background: #000000aa;
            color: white;
            border-radius: 16px;
            padding: 2px 8px;
            font-size: 12px;
        }
        .empty-state {
            grid-column: span 3;
            text-align: center;
            padding: 40px;
            color: #aaa;
        }

        .toast {
            position: fixed; bottom: 100px; left: 20px; right: 20px;
            background: #1d1832ee; backdrop-filter: blur(20px);
            border: 2px solid #bb99ff;
            color: white; text-align: center; padding: 16px;
            border-radius: 60px; font-weight: 600; z-index: 1000;
            animation: slide 2s forwards;
            max-width: 400px; margin: 0 auto;
        }
        @keyframes slide {
            0% { opacity:0; transform:translateY(40px); }
            15% { opacity:1; transform:translateY(0); }
            80% { opacity:1; }
            100% { opacity:0; transform:translateY(-30px); }
        }
    </style>
</head>
<body>
<div class="cat-reels-app">
    <div class="header">
        <span class="logo">üêà –ö–û–¢–û-–†–ò–õ–°</span>
        <span class="counter" id="globalCounter">0 –∫–æ—Ç–æ–≤</span>
    </div>
    <div class="content-scroll" id="contentArea"></div>
    <div class="upload-bar">
        <input type="text" class="url-input" id="urlInput" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ—Ç–∞ (jpg, mp4, gif)" value="https://cdn2.thecatapi.com/images/9j5.jpg">
        <button class="icon-btn" id="addUrlBtn">‚ûï</button>
        <button class="icon-btn" id="attachBtn">üìé</button>
        <input type="file" id="fileInput" accept="image/*,video/mp4,video/webm">
    </div>
    <div class="bottom-nav">
        <div class="nav-item active" id="navFeed">üè†<span>–õ–µ–Ω—Ç–∞</span></div>
        <div class="nav-item" id="navProfile">üò∫<span>–ü—Ä–æ—Ñ–∏–ª—å</span></div>
    </div>
</div>

<script>
    (function() {
        // ------------------------------------------------------------------
        // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø: —É–±—Ä–∞–Ω—ã blob-–æ—à–∏–±–∫–∏, —É–ª—É—á—à–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ
        // ------------------------------------------------------------------
        const CAT_API_IMAGES = 'https://api.thecatapi.com/v1/images/search?mime_types=jpg,png,gif&limit=6';
        const CAT_API_VIDEOS = 'https://api.thecatapi.com/v1/images/search?mime_types=mp4&limit=2';

        let allCats = [];
        let myCats = [];
        let currentScreen = 'feed';
        let isLoading = false;
        let hasMore = true;
        let errorCooldown = false;

        function loadStorage() {
            try {
                const data = JSON.parse(localStorage.getItem('cat_reels_optimized')) || { likedIds: [], myCats: [] };
                return data;
            } catch { return { likedIds: [], myCats: [] }; }
        }

        function saveStorage() {
            try {
                const likedIds = allCats.filter(c => c.liked).map(c => c.id);
                // –ò—Å–∫–ª—é—á–∞–µ–º –∫–æ—Ç–æ–≤ —Å blob-—Å—Å—ã–ª–∫–∞–º–∏ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–æ–Ω–∏ –Ω–µ –ø–µ—Ä–µ–∂–∏–≤—É—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É)
                const savedMyCats = myCats.filter(c => !c.url.startsWith('blob:'));
                localStorage.setItem('cat_reels_optimized', JSON.stringify({ likedIds, myCats: savedMyCats }));
            } catch (e) {}
        }

        const stored = loadStorage();

        function showToast(msg, isError = false) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.borderColor = isError ? '#ff7b8f' : '#bb99ff';
            toast.style.background = isError ? '#2d1a28ee' : '#1d1832ee';
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2500);
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return String(unsafe).replace(/[&<>"']/g, m => {
                if (m === '&') return '&amp;'; if (m === '<') return '&lt;'; if (m === '>') return '&gt;';
                if (m === '"') return '&quot;'; if (m === "'") return '&#039;';
                return m;
            });
        }

        function updateGlobalCounter() {
            document.getElementById('globalCounter').innerText = allCats.length + ' ' + 
                (allCats.length % 10 === 1 && allCats.length % 100 !== 11 ? '–∫–æ—Ç' : 
                ([2,3,4].includes(allCats.length % 10) && ![12,13,14].includes(allCats.length % 100) ? '–∫–æ—Ç–∞' : '–∫–æ—Ç–æ–≤'));
        }

        function toggleLike(catId) {
            const cat = allCats.find(c => c.id === catId);
            if (!cat) return;
            cat.liked = !cat.liked;
            cat.likes = cat.liked ? cat.likes + 1 : cat.likes - 1;
            saveStorage();

            if (currentScreen === 'feed') {
                const reel = document.querySelector(`.reel[data-id="${catId}"]`);
                if (reel) {
                    const btn = reel.querySelector('.like-btn');
                    const countSpan = reel.querySelector('.likes-count');
                    if (btn) {
                        btn.classList.toggle('liked', cat.liked);
                        btn.querySelector('span:first-child').innerText = cat.liked ? '‚ù§Ô∏è' : 'ü§ç';
                    }
                    if (countSpan) countSpan.innerText = cat.likes;
                }
            } else {
                renderProfile();
            }
        }

        function createSafeMedia(cat) {
            const container = document.createElement('div');
            container.className = 'media-container';

            if (cat.type === 'video') {
                const video = document.createElement('video');
                video.src = cat.url;
                video.autoplay = true;
                video.loop = true;
                video.muted = true;
                video.playsInline = true;
                video.preload = 'auto';
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ
                video.onerror = (e) => {
                    console.warn('Video error', cat.url, e);
                    container.innerHTML = `<div class="media-fallback"><span>üòø</span>–≤–∏–¥–µ–æ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å</div>`;
                };
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞: –µ—Å–ª–∏ –≤–∏–¥–µ–æ –∑–∞–≤–∏—Å–ª–æ
                video.onstalled = () => {
                    container.innerHTML = `<div class="media-fallback"><span>üòø</span>–≤–∏–¥–µ–æ –∑–∞–≤–∏—Å–ª–æ</div>`;
                };
                video.onabort = () => {
                    container.innerHTML = `<div class="media-fallback"><span>üòø</span>–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞</div>`;
                };
                container.appendChild(video);
            } else {
                const img = document.createElement('img');
                img.src = cat.url;
                img.alt = 'cat';
                img.loading = 'lazy';
                img.decoding = 'async';
                img.onerror = () => {
                    container.innerHTML = `<div class="media-fallback"><span>üòø</span>—Ñ–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å</div>`;
                };
                container.appendChild(img);
            }

            return container;
        }

        function createReel(cat) {
            const reelDiv = document.createElement('div');
            reelDiv.className = 'reel';
            reelDiv.dataset.id = cat.id;

            const mediaContainer = createSafeMedia(cat);
            const gradient = document.createElement('div');
            gradient.className = 'gradient';

            const footer = document.createElement('div');
            footer.className = 'reel-footer';
            footer.innerHTML = `
                <div class="cat-details">
                    <div class="avatar">${escapeHtml(cat.avatar)}</div>
                    <div>
                        <div class="name">${escapeHtml(cat.name)}</div>
                        <div class="origin">${escapeHtml(cat.origin)}</div>
                    </div>
                </div>
                <div class="actions">
                    <button class="like-btn ${cat.liked ? 'liked' : ''}" data-id="${cat.id}">
                        <span style="font-size:28px;">${cat.liked ? '‚ù§Ô∏è' : 'ü§ç'}</span>
                        <span class="likes-count">${cat.likes}</span>
                    </button>
                    <button class="action-btn">üí¨ 0</button>
                    <button class="action-btn">üì§</button>
                </div>
            `;

            reelDiv.appendChild(mediaContainer);
            reelDiv.appendChild(gradient);
            reelDiv.appendChild(footer);

            const likeBtn = footer.querySelector('.like-btn');
            likeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleLike(cat.id);
            });

            return reelDiv;
        }

        async function fetchWithRetry(url, retries = 2) {
            for (let i = 0; i <= retries; i++) {
                try {
                    const res = await fetch(url);
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    return await res.json();
                } catch (e) {
                    if (i === retries) throw e;
                    await new Promise(r => setTimeout(r, 1000 * (i + 1)));
                }
            }
        }

        async function loadMoreCats() {
            if (isLoading || !hasMore || currentScreen !== 'feed' || errorCooldown) return;

            isLoading = true;
            const feedDiv = document.querySelector('.feed');
            if (!feedDiv) {
                isLoading = false;
                return;
            }

            const loadingEl = document.createElement('div');
            loadingEl.className = 'loading-indicator';
            loadingEl.id = 'loading-spinner';
            loadingEl.innerHTML = '<div class="spinner"></div><span>–ó–∞–≥—Ä—É–∂–∞–µ–º –µ—â—ë –∫–æ—Ç–æ–≤...</span>';
            feedDiv.appendChild(loadingEl);

            try {
                const [imagesResult, videosResult] = await Promise.allSettled([
                    fetchWithRetry(CAT_API_IMAGES + '&_=' + Date.now(), 1),
                    fetchWithRetry(CAT_API_VIDEOS + '&_=' + Date.now(), 1)
                ]);

                let newApiCats = [];
                if (imagesResult.status === 'fulfilled' && Array.isArray(imagesResult.value)) {
                    newApiCats.push(...imagesResult.value);
                }
                if (videosResult.status === 'fulfilled' && Array.isArray(videosResult.value)) {
                    newApiCats.push(...videosResult.value);
                }

                if (newApiCats.length === 0) {
                    hasMore = false;
                    errorCooldown = true;
                    showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã—Ö –∫–æ—Ç–æ–≤, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 10 —Å–µ–∫', true);
                    setTimeout(() => {
                        hasMore = true;
                        errorCooldown = false;
                    }, 10000);
                } else {
                    const startIndex = allCats.length;
                    const newCats = newApiCats.map((item, idx) => ({
                        id: item.id || `api_${Date.now()}_${startIndex + idx}_${Math.random()}`,
                        name: ['–ú—É—Ä–∑–∏–∫','–ë–∞—Ä—Å–∏–∫','–°–Ω–µ–∂–æ–∫','–†—ã–∂–∏–∫','–ü—É—à–æ–∫','–ö–µ–∫—Å','–§–µ–ª–∏–∫—Å','–¢–æ–º','–õ–µ–æ–ø–æ–ª—å–¥','–°–∏–º–±–∞'][(startIndex + idx) % 10] + ' ' + (startIndex + idx + 1),
                        origin: 'The Cat API',
                        avatar: ['üêà','üò∏','üòª','üòΩ','üòº','üôÄ','üòø','üòæ'][(startIndex + idx) % 8],
                        url: item.url,
                        type: item.url.includes('.mp4') ? 'video' : 'image',
                        likes: 70 + Math.floor(Math.random() * 180),
                        liked: false,
                    }));

                    allCats.push(...newCats);
                    newCats.forEach(cat => feedDiv.appendChild(createReel(cat)));
                    updateGlobalCounter();
                    showToast(`‚ûï +${newCats.length} –∫–æ—Ç–æ–≤ –≤ –ª–µ–Ω—Ç–µ`);
                }
            } catch (error) {
                console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                showToast('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 10 —Å–µ–∫', true);
                errorCooldown = true;
                setTimeout(() => {
                    errorCooldown = false;
                }, 10000);
            } finally {
                const spinner = document.getElementById('loading-spinner');
                if (spinner) spinner.remove();
                isLoading = false;
            }
        }

        async function initialLoad() {
            if (isLoading) return;
            isLoading = true;
            showToast('–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ç–∏–∫–æ–≤...');

            try {
                const [imagesResult, videosResult] = await Promise.allSettled([
                    fetchWithRetry(CAT_API_IMAGES + '&_=' + Date.now()),
                    fetchWithRetry(CAT_API_VIDEOS + '&_=' + Date.now())
                ]);

                let apiCats = [];
                if (imagesResult.status === 'fulfilled') apiCats.push(...imagesResult.value);
                if (videosResult.status === 'fulfilled') apiCats.push(...videosResult.value);

                if (apiCats.length > 0) {
                    const newCats = apiCats.map((item, index) => ({
                        id: item.id || `api_init_${Date.now()}_${index}`,
                        name: ['–ú—É—Ä–∑–∏–∫','–ë–∞—Ä—Å–∏–∫','–°–Ω–µ–∂–æ–∫','–†—ã–∂–∏–∫','–ü—É—à–æ–∫','–ö–µ–∫—Å','–§–µ–ª–∏–∫—Å','–¢–æ–º','–õ–µ–æ–ø–æ–ª—å–¥','–°–∏–º–±–∞'][index % 10] + ' ' + (index+1),
                        origin: 'The Cat API',
                        avatar: ['üêà','üò∏','üòª','üòΩ','üòº','üôÄ','üòø','üòæ'][index % 8],
                        url: item.url,
                        type: item.url.includes('.mp4') ? 'video' : 'image',
                        likes: 70 + Math.floor(Math.random() * 180),
                        liked: false,
                    }));
                    allCats.push(...newCats);
                } else {
                    allCats.push({
                        id: 'fallback_main',
                        name: '–¢–µ—Å—Ç–æ–≤—ã–π –∫–æ—Ç',
                        origin: '–æ—Ñ–ª–∞–π–Ω',
                        avatar: 'üò∫',
                        url: 'https://cdn2.thecatapi.com/images/9j5.jpg',
                        type: 'image',
                        likes: 42,
                        liked: false,
                    });
                }
            } catch (error) {
                console.error('Initial load failed:', error);
                allCats.push({
                    id: 'fallback_error',
                    name: '–ö–æ—Ç–∏–∫',
                    origin: '—Ä–µ–∑–µ—Ä–≤–Ω—ã–π',
                    avatar: 'üòø',
                    url: 'https://cdn2.thecatapi.com/images/9j5.jpg',
                    type: 'image',
                    likes: 7,
                    liked: false,
                });
            } finally {
                isLoading = false;
            }

            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–∞–π–∫–∏ (–±–µ–∑ blob-—Å—Å—ã–ª–æ–∫)
            if (stored.likedIds) {
                allCats.forEach(c => { if (stored.likedIds.includes(c.id)) c.liked = true; });
            }
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–æ–∏—Ö –∫–æ—Ç–æ–≤, –∏—Å–∫–ª—é—á–∞—è blob-—Å—Å—ã–ª–∫–∏ (–æ–Ω–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å)
            if (stored.myCats && stored.myCats.length) {
                stored.myCats.forEach(c => {
                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ blob
                    if (!c.url.startsWith('blob:') && !allCats.some(x => x.id === c.id)) {
                        const restored = { ...c, liked: stored.likedIds.includes(c.id) };
                        allCats.unshift(restored);
                        myCats.push(restored);
                    }
                });
            }

            renderFeed();
        }

        function renderFeed() {
            const area = document.getElementById('contentArea');
            area.innerHTML = '';
            const feedDiv = document.createElement('div');
            feedDiv.className = 'feed';
            feedDiv.id = 'feedContainer';
            allCats.forEach(cat => feedDiv.appendChild(createReel(cat)));
            area.appendChild(feedDiv);
            updateGlobalCounter();

            feedDiv.addEventListener('scroll', handleInfiniteScroll);
        }

        function handleInfiniteScroll() {
            const feedDiv = document.getElementById('feedContainer');
            if (!feedDiv || isLoading || !hasMore || errorCooldown) return;

            const scrollTop = feedDiv.scrollTop;
            const scrollHeight = feedDiv.scrollHeight;
            const clientHeight = feedDiv.clientHeight;

            if (scrollHeight - scrollTop - clientHeight < 500) {
                loadMoreCats();
            }
        }

        function renderProfile() {
            const area = document.getElementById('contentArea');
            area.innerHTML = '';

            const likedCount = allCats.filter(c => c.liked).length;
            const myCount = myCats.length;

            const profileDiv = document.createElement('div');
            profileDiv.style.background = '#100e1c';
            profileDiv.style.height = '100%';
            profileDiv.style.overflowY = 'auto';

            profileDiv.innerHTML = `
                <div class="profile-header">
                    <div style="display:flex; gap:24px;">
                        <div class="big-avatar">üò∫</div>
                        <div class="profile-stats">
                            <div class="stat"><span class="stat-num">${myCount}</span><span class="stat-label"> –º–æ–∏</span></div>
                            <div class="stat"><span class="stat-num">${likedCount}</span><span class="stat-label"> –ª–∞–π–∫–∏</span></div>
                        </div>
                    </div>
                </div>
                <div class="tabs" id="profileTabs">
                    <div class="tab active" data-tab="my">üì¶ –ú–æ–∏</div>
                    <div class="tab" data-tab="liked">‚ù§Ô∏è –õ–∞–π–∫–Ω—É—Ç—ã–µ</div>
                </div>
                <div class="grid" id="profileGrid"></div>
            `;

            area.appendChild(profileDiv);

            const grid = document.getElementById('profileGrid');
            const tabs = document.querySelectorAll('.tab');
            let activeTab = 'my';

            function renderGrid(tab) {
                grid.innerHTML = '';
                let items = tab === 'my' ? myCats : allCats.filter(c => c.liked);
                if (items.length === 0) {
                    grid.innerHTML = '<div class="empty-state">üòø –∑–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ</div>';
                    return;
                }
                items.forEach(cat => {
                    const cell = document.createElement('div');
                    cell.className = 'grid-item';
                    cell.dataset.id = cat.id;
                    const media = cat.type === 'video' 
                        ? `<video src="${escapeHtml(cat.url)}" preload="metadata" muted onerror="this.outerHTML='<div class=\\'media-fallback\\' style=\\'height:100%;display:flex;align-items:center;justify-content:center;\\'><span>üòø</span></div>'"></video>` 
                        : `<img src="${escapeHtml(cat.url)}" loading="lazy" onerror="this.outerHTML='<div class=\\'media-fallback\\' style=\\'height:100%;display:flex;align-items:center;justify-content:center;\\'><span>üòø</span></div>'">`;
                    cell.innerHTML = media + (cat.type === 'video' ? '<span class="video-badge">üé¨</span>' : '');
                    cell.addEventListener('click', () => {
                        setScreen('feed');
                        requestAnimationFrame(() => {
                            const target = document.querySelector(`.reel[data-id="${cat.id}"]`);
                            if (target) {
                                target.scrollIntoView({ behavior: 'smooth' });
                            } else {
                                renderFeed();
                                requestAnimationFrame(() => {
                                    document.querySelector(`.reel[data-id="${cat.id}"]`)?.scrollIntoView({ behavior: 'smooth' });
                                });
                            }
                        });
                    });
                    grid.appendChild(cell);
                });
            }

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    activeTab = tab.dataset.tab;
                    renderGrid(activeTab);
                });
            });

            renderGrid('my');
        }

        function setScreen(screen) {
            currentScreen = screen;
            document.getElementById('navFeed').classList.toggle('active', screen === 'feed');
            document.getElementById('navProfile').classList.toggle('active', screen === 'profile');
            if (screen === 'feed') {
                renderFeed();
            } else {
                renderProfile();
            }
        }

        document.getElementById('navFeed').addEventListener('click', () => setScreen('feed'));
        document.getElementById('navProfile').addEventListener('click', () => setScreen('profile'));

        function addNewCat(catData) {
            const newCat = {
                id: 'user_' + Date.now() + '_' + Math.random().toString(36).substring(2,8),
                name: catData.name || '–ú–æ–π –∫–æ—Ç',
                origin: catData.origin || '–ó–∞–≥—Ä—É–∂–µ–Ω',
                avatar: catData.avatar || 'üì±',
                url: catData.url,
                type: catData.type || 'image',
                likes: catData.likes || 5,
                liked: false,
            };
            myCats.push(newCat);
            allCats.unshift(newCat);
            saveStorage();

            if (currentScreen === 'feed') {
                const feedDiv = document.querySelector('.feed');
                if (feedDiv) {
                    feedDiv.prepend(createReel(newCat));
                    feedDiv.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    renderFeed();
                }
            }
            updateGlobalCounter();
            showToast(`üê± ${newCat.name} –¥–æ–±–∞–≤–ª–µ–Ω`);
        }

        document.getElementById('addUrlBtn').addEventListener('click', () => {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) return showToast('–í—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É');
            addNewCat({
                name: '–ö–æ—Ç –ø–æ —Å—Å—ã–ª–∫–µ',
                origin: 'URL',
                avatar: 'üîó',
                url: url,
                type: /\.(mp4|webm|mov)$/i.test(url) ? 'video' : 'image',
            });
            document.getElementById('urlInput').value = '';
        });

        document.getElementById('attachBtn').addEventListener('click', () => document.getElementById('fileInput').click());
        document.getElementById('fileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const url = URL.createObjectURL(file);
            addNewCat({
                name: file.name.split('.')[0].slice(0,20),
                origin: '—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞',
                avatar: 'üì≤',
                url: url,
                type: file.type.startsWith('video/') ? 'video' : 'image',
            });
            document.getElementById('fileInput').value = '';
        });

        initialLoad();

        window.addEventListener('beforeunload', saveStorage);
    })();
</script>
</body>
</html>